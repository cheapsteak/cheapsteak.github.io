<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Responsive template swapping with Angular Directives &mdash; CheapSteak.net </title>
  <meta name="author" content="Chang Wang" />
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />

   <!-- Typekit -->
   <!--
   <script type="text/javascript" src="http://use.typekit.com/jpd0pfm.js"></script>
   <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-43310033-1', 'cheapsteak.net');
    ga('send', 'pageview');

  </script>
  <script type="text/javascript" src="//use.typekit.net/ogq1nyq.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body>
  <div class="site-wrapper">
    <header class="site-header">
        <a href="/"><img alt="" src="http://www.gravatar.com/avatar/7107daea85a92f08a890d6c268142043.png?size=260" class="avatar"></a>
        <h1 class="heading"><a class="home-link" href="/">Chang Wang</a></h1>
        <ul class="social-icons">
          <li class="github"><a class="icon-github" href="http://github.com/cheapsteak"></a></li>
          <li class="twitter"><a class="icon-twitter" href="http://twitter.com/cheapsteak"></a></li>
          <li class="rss"><a class="icon-rss" href="/atom.xml"></a> </li>
        </ul>
    </header>
    <section class="main">
      <article id="post">
  <h1>Responsive template swapping with Angular Directives</h1>
  <time>September 2013</time>
  <p>I've posted a few days ago on <a href="/posts/responsive-template-swapping-with-backbone">responsive template swapping with Backbone</a>, here's an example showing how to do that in Angular using a custom Directive.</p>

<p><button id="angular-toggler" class="hide-mid">Toggle width</button></p>

<p data-height="340" data-theme-id="1188" data-slug-hash="hfAxn" data-user="cheapsteak" data-default-tab="result" class='codepen'>See the Pen <a href='http://codepen.io/cheapsteak/pen/hfAxn'>hfAxn</a> by Chang Wang (<a href='http://codepen.io/cheapsteak'>@cheapsteak</a>) on <a href='http://codepen.io'>CodePen</a></p>


<script async src="http://codepen.io/assets/embed/ei.js"></script>




<script>
    window.deferreds = window.deferreds || [];
    window.deferreds.push(function () {
        $('#angular-toggler').click(function () {
            $('#cp_embed_hfAxn')
                .addClass('ease-in-out-back force-acceleration')
                .toggleClass('contracted');
        });
    });
</script>


<!--more-->


<p>The custom <code>breakpoint</code> directive takes a media-query as an argument (in this case <code>min-width: 44.375em</code>) and creates a <a href="https://developer.mozilla.org/en-US/docs/DOM/MediaQueryList">MediaQueryList</a> <code>mql</code> and a <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryListListener">MediaQueryListListener</a> <code>mqlListener</code>, which will update our custom scope variable <code>matches</code> so it will always reflect the result of the media-query (in our case, <code>scope.matches</code> will be <code>false</code> when width is smaller than <code>44.375em</code> and <code>true</code> when width is larger).</p>

<p>Since the media-query event that triggers the change to the scope variable <code>matches</code> is not generated by Angular, we will need to update our view by calling <code>scope.$apply()</code> to manually start the digest cycle. However, since page-load doesn't trigger media-query events, and since we still want the right layout to be displayed on page-load, we also need to make a direct call to <code>mqlListener(mql)</code> during the directive's initialization, which is during an existing digest cycle. Calling <code>scope.$apply()</code> then would result in an <code>Action Alredy In Progress</code> error, so we check <code>scope.$$phase</code> and only call scope.$apply when not in an existing digest cycle. Hence the weird looking:</p>

<div class="highlight"><pre><code class="javascript"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">scope</span><span class="p">.</span><span class="nx">$$phase</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// make sure we&#39;re not in the middle of a digest cycle</span>
    <span class="nx">scope</span><span class="p">.</span><span class="nx">$apply</span><span class="p">();</span> <span class="c1">//start the digest cycle</span>
<span class="p">}</span>
</code></pre></div>


<p>This and the Backbone example are <a href="https://github.com/cheapsteak/ResponsiveTemplateSwapComparison">available on GitHub</a>. Shoot me a pull request or a <a href="https://twitter.com/CheapSteak">tweet</a> and let me know what you think!</p>

</article>

    </section>
  </div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>
  window.jQuery || document.write('<script src="/js/jquery.min.js">\u003c\/script>')
  if (window.deferreds) {
    $.each(window.deferreds, function (i, fn) { fn(); });
  }
</script>
</body>
</html>
